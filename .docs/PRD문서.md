# 📄 PRD: Product Requirements Document

## 🧩 제품명: FSM 처리 서버

> 게임 및 시뮬레이션 서버에서 상태 기반 로직을 중앙 집중식으로 처리하고 로그 기록까지 담당하는 FSM 백엔드 서버

---

## 1. 목적

- 퀘스트, 매칭, 보상, 유닛 생성 등 **상태 기반 로직을 서버에서 공통적으로 처리**할 수 있게 함
- 각 게임 모듈이 독립적으로 FSM을 정의하고 호출할 수 있도록 유연한 구조 제공

## 2. 기능 요약

| 기능            | 설명                                               |
| --------------- | -------------------------------------------------- |
| 상태 전이 API   | 유저 ID, FSM 타입, 목표 상태를 받아 유효 전이 수행 |
| 상태 조회 API   | 유저의 현재 FSM 상태 조회                          |
| 전이 로그 기록  | Celery 비동기 태스크로 로그 남김                   |
| 상태 정의 로딩  | FSM 정의는 JSON으로 로딩하며 FSM별로 독립 관리     |
| Flower 대시보드 | 워커 상태 시각화                                   |

## 3. 기술 스택

| 구성                | 기술                                    |
| ------------------- | --------------------------------------- |
| API 서버            | FastAPI (Python 3.13)                   |
| 상태 저장 및 브로커 | Redis 7                                 |
| 비동기 워커         | Celery 5                                |
| 모니터링 대시보드   | Flower                                  |
| 배포                | Docker Compose, 로컬 핫리로드 분리 구성 |

## 4. 요구사항

- 전이 실패 시 오류 응답 제공
- FSM 정의는 유효성 검사를 거쳐야 함
- 상태는 Redis에 TTL 없이 저장되며 지속성은 로그로 해결
- Celery 태스크는 워커 장애 시 재시도 보장
